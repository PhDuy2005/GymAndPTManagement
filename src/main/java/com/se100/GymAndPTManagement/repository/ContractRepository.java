/**
 * Generated by: GitHub Copilot (Claude Haiku 4.5)
 * Created by: KStuv
 * Created at: 2026-01-09 14:50:00
 * Purpose: Repository for Contract entity management
 */
package com.se100.GymAndPTManagement.repository;

import com.se100.GymAndPTManagement.domain.table.Contract;
import com.se100.GymAndPTManagement.util.enums.ContractStatusEnum;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

@Repository
public interface ContractRepository extends JpaRepository<Contract, Long> {
    List<Contract> findByMemberId(Long memberId);
    
    List<Contract> findByMainPtId(Long ptId);
    
    List<Contract> findByStatus(ContractStatusEnum status);
    
    List<Contract> findByStatusOrderByEndDateDesc(ContractStatusEnum status);

    /**
     * Find active contract for a member that covers a specific date
     */
    @Query("""
        SELECT c FROM Contract c
        WHERE c.member.id = :memberId
        AND c.status = :status
        AND c.startDate <= :bookingDate
        AND c.endDate >= :bookingDate
        LIMIT 1
    """)
    Optional<Contract> findByMemberIdAndStatusAndDateRange(
        @Param("memberId") Long memberId,
        @Param("status") ContractStatusEnum status,
        @Param("bookingDate") LocalDate bookingDate
    );
}
