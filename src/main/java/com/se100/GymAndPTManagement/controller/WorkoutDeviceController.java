/**
 * Generated by: GitHub Copilot (Claude Sonnet 4.5)
 * Created by: Danh
 * Created at: 2026-01-10 15:18:57
 * Purpose: REST Controller for WorkoutDevice (Inventory) management
 */

package com.se100.GymAndPTManagement.controller;

import com.se100.GymAndPTManagement.domain.requestDTO.ReqWorkoutDeviceDTO;
import com.se100.GymAndPTManagement.domain.responseDTO.ResWorkoutDeviceDTO;
import com.se100.GymAndPTManagement.service.WorkoutDeviceService;
import com.se100.GymAndPTManagement.util.annotation.ApiMessage;
import lombok.AllArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;

@RestController
@RequestMapping("/api/v1/workout-devices")
@AllArgsConstructor
@Validated
public class WorkoutDeviceController {
    
    private final WorkoutDeviceService workoutDeviceService;
    
    @PostMapping
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Thêm thiết bị mới (Admin/PT)")
    public ResponseEntity<ResWorkoutDeviceDTO> createWorkoutDevice(@Valid @RequestBody ReqWorkoutDeviceDTO reqWorkoutDeviceDTO) {
        ResWorkoutDeviceDTO resWorkoutDeviceDTO = workoutDeviceService.createWorkoutDevice(reqWorkoutDeviceDTO);
        return new ResponseEntity<>(resWorkoutDeviceDTO, HttpStatus.CREATED);
    }
    
    @GetMapping("/{id}")
    @ApiMessage("Lấy thông tin thiết bị theo ID")
    public ResponseEntity<ResWorkoutDeviceDTO> getWorkoutDeviceById(@PathVariable Long id) {
        ResWorkoutDeviceDTO resWorkoutDeviceDTO = workoutDeviceService.getWorkoutDeviceById(id);
        return new ResponseEntity<>(resWorkoutDeviceDTO, HttpStatus.OK);
    }
    
    @GetMapping
    @ApiMessage("Lấy danh sách tất cả thiết bị (phân trang)")
    public ResponseEntity<Page<ResWorkoutDeviceDTO>> getAllWorkoutDevices(Pageable pageable) {
        Page<ResWorkoutDeviceDTO> devices = workoutDeviceService.getAllWorkoutDevices(pageable);
        return new ResponseEntity<>(devices, HttpStatus.OK);
    }
    
    @GetMapping("/by-name/{name}")
    @ApiMessage("Tìm thiết bị theo tên")
    public ResponseEntity<ResWorkoutDeviceDTO> getWorkoutDeviceByName(@PathVariable String name) {
        ResWorkoutDeviceDTO resWorkoutDeviceDTO = workoutDeviceService.getWorkoutDeviceByName(name);
        return new ResponseEntity<>(resWorkoutDeviceDTO, HttpStatus.OK);
    }
    
    @GetMapping("/by-type/{equipmentType}")
    @ApiMessage("Lấy thiết bị theo loại")
    public ResponseEntity<List<ResWorkoutDeviceDTO>> getWorkoutDevicesByType(@PathVariable String equipmentType) {
        List<ResWorkoutDeviceDTO> devices = workoutDeviceService.getWorkoutDevicesByType(equipmentType);
        return new ResponseEntity<>(devices, HttpStatus.OK);
    }
    
    @GetMapping("/by-status/{status}")
    @ApiMessage("Lấy thiết bị theo trạng thái")
    public ResponseEntity<List<ResWorkoutDeviceDTO>> getWorkoutDevicesByStatus(@PathVariable String status) {
        List<ResWorkoutDeviceDTO> devices = workoutDeviceService.getWorkoutDevicesByStatus(status);
        return new ResponseEntity<>(devices, HttpStatus.OK);
    }
    
    @GetMapping("/search")
    @ApiMessage("Tìm kiếm thiết bị")
    public ResponseEntity<List<ResWorkoutDeviceDTO>> searchWorkoutDevices(@RequestParam String name) {
        List<ResWorkoutDeviceDTO> devices = workoutDeviceService.searchWorkoutDevices(name);
        return new ResponseEntity<>(devices, HttpStatus.OK);
    }
    
    @GetMapping("/count/{status}")
    @ApiMessage("Đếm số thiết bị theo trạng thái")
    public ResponseEntity<Long> getDeviceCountByStatus(@PathVariable String status) {
        Long count = workoutDeviceService.getDeviceCountByStatus(status);
        return new ResponseEntity<>(count, HttpStatus.OK);
    }
    
    @PutMapping("/{id}")
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Cập nhật thiết bị (Admin/PT)")
    public ResponseEntity<ResWorkoutDeviceDTO> updateWorkoutDevice(@PathVariable Long id, 
                                                                    @Valid @RequestBody ReqWorkoutDeviceDTO reqWorkoutDeviceDTO) {
        ResWorkoutDeviceDTO resWorkoutDeviceDTO = workoutDeviceService.updateWorkoutDevice(id, reqWorkoutDeviceDTO);
        return new ResponseEntity<>(resWorkoutDeviceDTO, HttpStatus.OK);
    }
    
    @DeleteMapping("/{id}")
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Xóa thiết bị (Admin/PT)")
    public ResponseEntity<Void> deleteWorkoutDevice(@PathVariable Long id) {
        workoutDeviceService.deleteWorkoutDevice(id);
        return new ResponseEntity<>(HttpStatus.NO_CONTENT);
    }
}






