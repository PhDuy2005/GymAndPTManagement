/**
 * Generated by: GitHub Copilot (Claude Sonnet 4.5)
 * Created by: Danh
 * Created at: 2026-01-10 15:18:57
 * Purpose: REST Controller for Workout (Exercise Library) management
 */

package com.se100.GymAndPTManagement.controller;

import com.se100.GymAndPTManagement.domain.requestDTO.ReqWorkoutDTO;
import com.se100.GymAndPTManagement.domain.responseDTO.ResWorkoutDTO;
import com.se100.GymAndPTManagement.service.WorkoutService;
import com.se100.GymAndPTManagement.util.annotation.ApiMessage;
import lombok.AllArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;

@RestController
@RequestMapping("/api/v1/workouts")
@AllArgsConstructor
@Validated
public class WorkoutController {
    
    private final WorkoutService workoutService;
    
    @PostMapping
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Tạo bài tập mới (Admin/PT)")
    public ResponseEntity<ResWorkoutDTO> createWorkout(@Valid @RequestBody ReqWorkoutDTO reqWorkoutDTO) {
        ResWorkoutDTO resWorkoutDTO = workoutService.createWorkout(reqWorkoutDTO);
        return new ResponseEntity<>(resWorkoutDTO, HttpStatus.CREATED);
    }
    
    @GetMapping("/{id}")
    @ApiMessage("Lấy thông tin bài tập theo ID")
    public ResponseEntity<ResWorkoutDTO> getWorkoutById(@PathVariable Long id) {
        ResWorkoutDTO resWorkoutDTO = workoutService.getWorkoutById(id);
        return new ResponseEntity<>(resWorkoutDTO, HttpStatus.OK);
    }
    
    @GetMapping
    @ApiMessage("Lấy danh sách tất cả bài tập (phân trang)")
    public ResponseEntity<Page<ResWorkoutDTO>> getAllWorkouts(Pageable pageable) {
        Page<ResWorkoutDTO> workouts = workoutService.getAllWorkouts(pageable);
        return new ResponseEntity<>(workouts, HttpStatus.OK);
    }
    
    @GetMapping("/by-name/{name}")
    @ApiMessage("Tìm bài tập theo tên")
    public ResponseEntity<ResWorkoutDTO> getWorkoutByName(@PathVariable String name) {
        ResWorkoutDTO resWorkoutDTO = workoutService.getWorkoutByName(name);
        return new ResponseEntity<>(resWorkoutDTO, HttpStatus.OK);
    }
    
    @GetMapping("/by-difficulty/{difficulty}")
    @ApiMessage("Lấy bài tập theo độ khó")
    public ResponseEntity<List<ResWorkoutDTO>> getWorkoutsByDifficulty(@PathVariable String difficulty) {
        List<ResWorkoutDTO> workouts = workoutService.getWorkoutsByDifficulty(difficulty);
        return new ResponseEntity<>(workouts, HttpStatus.OK);
    }
    
    @GetMapping("/by-device/{deviceId}")
    @ApiMessage("Lấy bài tập theo thiết bị")
    public ResponseEntity<List<ResWorkoutDTO>> getWorkoutsByDevice(@PathVariable Long deviceId) {
        List<ResWorkoutDTO> workouts = workoutService.getWorkoutsByDevice(deviceId);
        return new ResponseEntity<>(workouts, HttpStatus.OK);
    }
    
    @GetMapping("/search")
    @ApiMessage("Tìm kiếm bài tập")
    public ResponseEntity<List<ResWorkoutDTO>> searchWorkouts(@RequestParam String name) {
        List<ResWorkoutDTO> workouts = workoutService.searchWorkouts(name);
        return new ResponseEntity<>(workouts, HttpStatus.OK);
    }
    
    @PutMapping("/{id}")
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Cập nhật bài tập (Admin/PT)")
    public ResponseEntity<ResWorkoutDTO> updateWorkout(@PathVariable Long id, 
                                                        @Valid @RequestBody ReqWorkoutDTO reqWorkoutDTO) {
        ResWorkoutDTO resWorkoutDTO = workoutService.updateWorkout(id, reqWorkoutDTO);
        return new ResponseEntity<>(resWorkoutDTO, HttpStatus.OK);
    }
    
    @DeleteMapping("/{id}")
    @PreAuthorize("hasAnyRole('ADMIN', 'PERSONAL_TRAINER')")
    @ApiMessage("Xóa bài tập (Admin/PT)")
    public ResponseEntity<Void> deleteWorkout(@PathVariable Long id) {
        workoutService.deleteWorkout(id);
        return new ResponseEntity<>(HttpStatus.NO_CONTENT);
    }
}






