package com.se100.GymAndPTManagement.controller;

import java.math.BigDecimal;
import java.util.List;

import org.springdoc.core.annotations.ParameterObject;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.se100.GymAndPTManagement.domain.requestDTO.ReqCreateFoodDTO;
import com.se100.GymAndPTManagement.domain.requestDTO.ReqUpdateFoodDTO;
import com.se100.GymAndPTManagement.domain.responseDTO.ResFoodDTO;
import com.se100.GymAndPTManagement.domain.responseDTO.ResultPaginationDTO;
import com.se100.GymAndPTManagement.domain.table.Food;
import com.se100.GymAndPTManagement.service.FoodService;
import com.se100.GymAndPTManagement.util.annotation.ApiMessage;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import jakarta.validation.Valid;

/**
 * Generated by: GitHub Copilot (Claude Sonnet 4.5)
 * Created by: PhDuy2005
 * Created at: 2026-01-15 14:30:00
 * Purpose: Food controller for nutrition database management
 */
@RestController
@RequestMapping("/api/v1/foods")
public class FoodController {

        private final FoodService foodService;

        public FoodController(FoodService foodService) {
                this.foodService = foodService;
        }

        @Operation(summary = "Create new food")
        @ApiResponses({
                        @ApiResponse(responseCode = "201", description = "Food created successfully"),
                        @ApiResponse(responseCode = "400", description = "Invalid request data"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @PostMapping
        @ApiMessage("Tạo thực phẩm mới") // approved
        public ResponseEntity<ResFoodDTO> createFood(@Valid @RequestBody ReqCreateFoodDTO request) {
                ResFoodDTO food = foodService.createFood(request);
                return ResponseEntity.status(HttpStatus.CREATED).body(food);
        }

        @Operation(summary = "Get food by ID")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "404", description = "Food not found"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/{id}")
        @ApiMessage("Lấy thông tin thực phẩm theo ID") // approved
        public ResponseEntity<ResFoodDTO> getFoodById(@PathVariable("id") Long id) {
                ResFoodDTO food = foodService.getFoodById(id);
                return ResponseEntity.ok(food);
        }

        @Operation(summary = "Get all foods. Warning: may return large dataset, recommended to use GET \"/api/v1/foods/fetch\" with pagination and filter instead")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping
        @ApiMessage("Lấy danh sách tất cả thực phẩm") // approved, but not recommended for large datasets
        public ResponseEntity<List<ResFoodDTO>> getAllFoods() {
                List<ResFoodDTO> foods = foodService.getAllFoods();
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get active foods only")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/active")
        @ApiMessage("Lấy danh sách thực phẩm đang hoạt động")
        public ResponseEntity<List<ResFoodDTO>> getActiveFoods() {
                List<ResFoodDTO> foods = foodService.getActiveFoods();
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Search foods by keyword")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/search")
        @ApiMessage("Tìm kiếm thực phẩm theo từ khóa")
        public ResponseEntity<ResultPaginationDTO> searchFoods(
                        @Parameter(description = "Search keyword") @RequestParam("keyword") String keyword,
                        @ParameterObject Pageable pageable) {
                ResultPaginationDTO foods = foodService.searchFoods(keyword, pageable);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get foods by type")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/by-type/{type}")
        @ApiMessage("Lấy thực phẩm theo loại (PROTEIN/CARBOHYDRATE/FAT)")
        public ResponseEntity<ResultPaginationDTO> getFoodsByType(
                        @Parameter(description = "Food type: PROTEIN, CARBOHYDRATE, FAT") @PathVariable("type") String type,
                        @ParameterObject Pageable pageable) {
                if (!type.equals("PROTEIN") && !type.equals("CARBOHYDRATE") && !type.equals("FAT")) {
                        throw new IllegalArgumentException("Invalid food type. Must be PROTEIN, CARBOHYDRATE, or FAT.");
                }
                ResultPaginationDTO foods = foodService.getFoodsByType(type, pageable);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get foods by calories range")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/by-calories")
        @ApiMessage("Lấy thực phẩm theo khoảng calories")
        public ResponseEntity<ResultPaginationDTO> getFoodsByCaloriesRange(
                        @Parameter(description = "Minimum calories") @RequestParam("min") BigDecimal min,
                        @Parameter(description = "Maximum calories") @RequestParam("max") BigDecimal max,
                        @ParameterObject Pageable pageable) {
                ResultPaginationDTO foods = foodService.getFoodsByCaloriesRange(min, max, pageable);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get top protein foods")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/top-protein")
        @ApiMessage("Lấy danh sách thực phẩm giàu protein nhất")
        public ResponseEntity<List<ResFoodDTO>> getTopProteinFoods(
                        @Parameter(description = "Number of results") @RequestParam(defaultValue = "10", value = "limit") int limit) {
                List<ResFoodDTO> foods = foodService.getTopProteinFoods(limit);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get top carbohydrate foods")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/top-carb")
        @ApiMessage("Lấy danh sách thực phẩm giàu carbohydrate nhất")
        public ResponseEntity<List<ResFoodDTO>> getTopCarbFoods(
                        @Parameter(description = "Number of results") @RequestParam(defaultValue = "10", value = "limit") int limit) {
                List<ResFoodDTO> foods = foodService.getTopCarbFoods(limit);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Get top fat foods")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Success"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @GetMapping("/top-fat")
        @ApiMessage("Lấy danh sách thực phẩm giàu fat nhất")
        public ResponseEntity<List<ResFoodDTO>> getTopFatFoods(
                        @Parameter(description = "Number of results") @RequestParam(defaultValue = "10", value = "limit") int limit) {
                List<ResFoodDTO> foods = foodService.getTopFatFoods(limit);
                return ResponseEntity.ok(foods);
        }

        @Operation(summary = "Update food")
        @ApiResponses({
                        @ApiResponse(responseCode = "200", description = "Food updated successfully"),
                        @ApiResponse(responseCode = "404", description = "Food not found"),
                        @ApiResponse(responseCode = "400", description = "Invalid request data"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @PutMapping("/{id}")
        @ApiMessage("Cập nhật thông tin thực phẩm")
        public ResponseEntity<ResFoodDTO> updateFood(
                        @PathVariable Long id,
                        @Valid @RequestBody ReqUpdateFoodDTO request) {
                ResFoodDTO food = foodService.updateFood(id, request);
                return ResponseEntity.ok(food);
        }

        @Operation(summary = "Delete food (soft delete)")
        @ApiResponses({
                        @ApiResponse(responseCode = "204", description = "Food deleted successfully"),
                        @ApiResponse(responseCode = "404", description = "Food not found"),
                        @ApiResponse(responseCode = "401", description = "Unauthorized")
        })
        @DeleteMapping("/{id}")
        @ApiMessage("Xóa thực phẩm (soft delete)")
        public ResponseEntity<Void> deleteFood(@PathVariable Long id) {
                foodService.deleteFood(id);
                return ResponseEntity.noContent().build();
        }
}
