/**
 * Simple test to verify BookingIntegrationTestBase setup
 * Generated by: GitHub Copilot (Claude Haiku 4.5)
 * Created by: KStuv
 * Created at: 2026-01-16 11:00:00
 * Purpose: Verify test infrastructure works without full compilation
 */
package com.se100.GymAndPTManagement.integration.service;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import static org.junit.jupiter.api.Assertions.*;

import com.se100.GymAndPTManagement.domain.table.*;
import com.se100.GymAndPTManagement.integration.BookingIntegrationTestBase;
import com.se100.GymAndPTManagement.integration.testdata.TestDataFactory;

@DisplayName("BookingService Integration Tests - Simple Verification")
public class BookingServiceIntegrationTestSimple extends BookingIntegrationTestBase {

    /**
     * Test: Verify test infrastructure setup
     */
    @Test
    @DisplayName("Test Infrastructure - Verify Setup")
    public void testInfrastructureSetup() {
        // Verify repositories are injected
        assertNotNull(userRepository);
        assertNotNull(memberRepository);
        assertNotNull(personalTrainerRepository);
        assertNotNull(contractRepository);
        assertNotNull(bookingRepository);
        assertNotNull(slotRepository);

        // Verify services are injected
        assertNotNull(bookingService);
        assertNotNull(contractService);

        // Verify MockMvc is available
        assertNotNull(mockMvc);

        // Verify initial state is clean
        assertEquals(0, countAllMembers());
        assertEquals(0, countAllBookings());
    }

    /**
     * Test: Create and save User entity
     */
    @Test
    @DisplayName("Test Data Builder - User Creation")
    public void testUserBuilder() {
        User user = TestDataFactory.createUser("test@example.com", "Test User");

        assertNotNull(user);
        assertEquals("test@example.com", user.getEmail());
        assertEquals("Test User", user.getFullname());

        // Save and verify
        User savedUser = userRepository.save(user);
        assertNotNull(savedUser.getId());
        assertEquals("test@example.com", savedUser.getEmail());
    }

    /**
     * Test: Create and save Member entity
     */
    @Test
    @DisplayName("Test Data Builder - Member Creation")
    public void testMemberBuilder() {
        User user = TestDataFactory.createUser("member@test.com", "Member");
        user = userRepository.save(user);

        Member member = TestDataFactory.createMember(user);

        assertNotNull(member);
        assertEquals(user.getId(), member.getUser().getId());

        // Save and verify
        Member savedMember = memberRepository.save(member);
        assertNotNull(savedMember.getId());
        assertEquals(1, countAllMembers());
    }

    /**
     * Test: Create and save PersonalTrainer entity
     */
    @Test
    @DisplayName("Test Data Builder - PersonalTrainer Creation")
    public void testPersonalTrainerBuilder() {
        User user = TestDataFactory.createUser("pt@test.com", "PT User");
        user = userRepository.save(user);

        PersonalTrainer pt = TestDataFactory.createPersonalTrainer(user);

        assertNotNull(pt);
        assertEquals("Fitness", pt.getSpecialization());

        // Save and verify
        PersonalTrainer savedPt = personalTrainerRepository.save(pt);
        assertNotNull(savedPt.getId());
    }

    /**
     * Test: Create and save Contract entity
     */
    @Test
    @DisplayName("Test Data Builder - Contract Creation")
    public void testContractBuilder() {
        User memberUser = TestDataFactory.createUser("m1@test.com", "Member 1");
        memberUser = userRepository.save(memberUser);
        Member member = TestDataFactory.createMember(memberUser);
        member = memberRepository.save(member);

        User ptUser = TestDataFactory.createUser("pt1@test.com", "PT 1");
        ptUser = userRepository.save(ptUser);
        PersonalTrainer pt = TestDataFactory.createPersonalTrainer(ptUser);
        pt = personalTrainerRepository.save(pt);

        ServicePackage pkg = TestDataFactory.createServicePackage();
        pkg = servicePackageRepository.save(pkg);

        Contract contract = TestDataFactory.createContract(member, pt, pkg);

        assertNotNull(contract);
        assertEquals(10, contract.getTotalSessions());

        // Save and verify
        Contract savedContract = contractRepository.save(contract);
        assertNotNull(savedContract.getId());
        assertEquals(1, countAllContracts());
    }

    /**
     * Test: Verify transaction isolation between tests
     */
    @Test
    @DisplayName("Test Isolation - Data Cleanup Between Tests")
    public void testDataCleanup() {
        // Each test should start with clean state
        assertEquals(0, countAllMembers());
        assertEquals(0, countAllBookings());

        // Add data
        User user = TestDataFactory.createUser("test@test.com", "Test");
        user = userRepository.save(user);
        Member member = TestDataFactory.createMember(user);
        memberRepository.save(member);

        assertEquals(1, countAllMembers());

        // After this test, data will be rolled back
    }

}
