# SlotController Documentation

> **Generated by**: GitHub Copilot (Claude Sonnet 4.5)  
> **Created by**: PhDuy2005  
> **Created at**: 2026-01-14 00:53:15  
> **Last Updated**: 2026-01-14 00:53:15  
> **Controller**: `SlotController`  
> **Base URL**: `/api/v1/slots`

---

## ğŸ“‹ Overview

Controller quáº£n lÃ½ cÃ¡c khung giá» (Slots) trong há»‡ thá»‘ng Gym & PT Management - tÆ°Æ¡ng tá»± nhÆ° tiáº¿t há»c trong thá»i khÃ³a biá»ƒu.

**Chá»©c nÄƒng chÃ­nh**:
- Quáº£n lÃ½ danh sÃ¡ch khung giá» (thÃªm, sá»­a, xÃ³a, xem)
- Quáº£n lÃ½ thá»i gian báº¯t Ä‘áº§u vÃ  káº¿t thÃºc cá»§a má»—i slot
- Validate logic thá»i gian (start_time < end_time)
- Quáº£n lÃ½ tráº¡ng thÃ¡i active/inactive
- Lá»c slot theo tráº¡ng thÃ¡i active
- PhÃ¢n trang vÃ  lá»c dá»¯ liá»‡u

---

## ğŸ”— Endpoints

### 1. Create Slot
**POST** `/api/v1/slots`

**Description**: Táº¡o khung giá» má»›i

**Request Body**:
```json
{
  "slotName": "Slot 1 - SÃ¡ng sá»›m",
  "startTime": "06:00:00",
  "endTime": "08:00:00"
}
```

**Validation Rules**:
- `slotName`: Required, khÃ´ng Ä‘Æ°á»£c trá»‘ng
- `startTime`: Required, pháº£i lÃ  thá»i gian há»£p lá»‡
- `endTime`: Required, pháº£i lÃ  thá»i gian há»£p lá»‡
- `startTime` pháº£i nhá» hÆ¡n `endTime`

**Success Response** (201 Created):
```json
{
  "statusCode": 201,
  "message": "Create new slot",
  "data": {
    "id": 1,
    "slotName": "Slot 1 - SÃ¡ng sá»›m",
    "startTime": "06:00:00",
    "endTime": "08:00:00",
    "isActive": true,
    "createdAt": "2026-01-14T00:53:15.123456Z",
    "updatedAt": null,
    "createdBy": "admin",
    "updatedBy": null
  }
}
```

**Error Response** (400 Bad Request):
```json
{
  "statusCode": 400,
  "message": "Start time must be before end time",
  "error": "Bad Request"
}
```

---

### 2. Get All Slots
**GET** `/api/v1/slots`

**Description**: Láº¥y danh sÃ¡ch táº¥t cáº£ cÃ¡c slot (bao gá»“m cáº£ inactive)

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Get all slots",
  "data": [
    {
      "id": 1,
      "slotName": "Slot 1 - SÃ¡ng sá»›m",
      "startTime": "06:00:00",
      "endTime": "08:00:00",
      "isActive": true,
      "createdAt": "2026-01-14T00:53:15.123456Z",
      "updatedAt": null,
      "createdBy": "admin",
      "updatedBy": null
    },
    {
      "id": 2,
      "slotName": "Slot 2 - Buá»•i sÃ¡ng",
      "startTime": "08:00:00",
      "endTime": "10:00:00",
      "isActive": true,
      "createdAt": "2026-01-14T01:00:00.123456Z",
      "updatedAt": null,
      "createdBy": "admin",
      "updatedBy": null
    }
  ]
}
```

---

### 3. Fetch Slots with Filter (Pagination)
**GET** `/api/v1/slots/fetch`

**Description**: Láº¥y danh sÃ¡ch slot vá»›i phÃ¢n trang vÃ  lá»c theo Ä‘iá»u kiá»‡n

**Query Parameters**:
- `page`: Sá»‘ trang (báº¯t Ä‘áº§u tá»« 0), máº·c Ä‘á»‹nh = 0
- `size`: Sá»‘ lÆ°á»£ng item má»—i trang, máº·c Ä‘á»‹nh = 10
- `filter`: Spring-Filter expression (optional)

**Filter Examples**:
```
# Lá»c slot Ä‘ang active
?filter=isActive==true

# Lá»c theo thá»i gian báº¯t Ä‘áº§u
?filter=startTime>='08:00:00'

# Lá»c theo khoáº£ng thá»i gian
?filter=startTime>='08:00:00' and endTime<='18:00:00'

# Lá»c theo tÃªn slot
?filter=slotName~'*SÃ¡ng*'

# Káº¿t há»£p nhiá»u Ä‘iá»u kiá»‡n
?filter=isActive==true and startTime>='06:00:00'
```

**Full Request Example**:
```
GET /api/v1/slots/fetch?page=0&size=10&filter=isActive==true
```

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Fetch slots with filter",
  "data": {
    "meta": {
      "page": 1,
      "pageSize": 10,
      "totalPages": 2,
      "totalItems": 15
    },
    "result": [
      {
        "id": 1,
        "slotName": "Slot 1 - SÃ¡ng sá»›m",
        "startTime": "06:00:00",
        "endTime": "08:00:00",
        "isActive": true,
        "createdAt": "2026-01-14T00:53:15.123456Z",
        "updatedAt": null,
        "createdBy": "admin",
        "updatedBy": null
      }
    ]
  }
}
```

---

### 4. Get Slot by ID
**GET** `/api/v1/slots/{id}`

**Description**: Láº¥y thÃ´ng tin chi tiáº¿t má»™t slot theo ID

**Path Parameters**:
- `id`: ID cá»§a slot (Long)

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Get slot by ID",
  "data": {
    "id": 1,
    "slotName": "Slot 1 - SÃ¡ng sá»›m",
    "startTime": "06:00:00",
    "endTime": "08:00:00",
    "isActive": true,
    "createdAt": "2026-01-14T00:53:15.123456Z",
    "updatedAt": null,
    "createdBy": "admin",
    "updatedBy": null
  }
}
```

**Error Response** (404 Not Found):
```json
{
  "statusCode": 404,
  "message": "Slot not found with id: 999",
  "error": "Id Invalid Exception"
}
```

---

### 5. Get All Active Slots
**GET** `/api/v1/slots/active`

**Description**: Láº¥y danh sÃ¡ch cÃ¡c slot Ä‘ang active (isActive = true)

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Get all active slots",
  "data": [
    {
      "id": 1,
      "slotName": "Slot 1 - SÃ¡ng sá»›m",
      "startTime": "06:00:00",
      "endTime": "08:00:00",
      "isActive": true,
      "createdAt": "2026-01-14T00:53:15.123456Z",
      "updatedAt": null,
      "createdBy": "admin",
      "updatedBy": null
    }
  ]
}
```

---

### 6. Update Slot
**PUT** `/api/v1/slots/{id}`

**Description**: Cáº­p nháº­t thÃ´ng tin slot

**Path Parameters**:
- `id`: ID cá»§a slot cáº§n cáº­p nháº­t

**Request Body**:
```json
{
  "slotName": "Slot 1 - SÃ¡ng sá»›m (Updated)",
  "startTime": "06:30:00",
  "endTime": "08:30:00"
}
```

**Validation Rules**:
- `slotName`: Required, khÃ´ng Ä‘Æ°á»£c trá»‘ng
- `startTime`: Required, pháº£i lÃ  thá»i gian há»£p lá»‡
- `endTime`: Required, pháº£i lÃ  thá»i gian há»£p lá»‡
- `startTime` pháº£i nhá» hÆ¡n `endTime`

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Update slot",
  "data": {
    "id": 1,
    "slotName": "Slot 1 - SÃ¡ng sá»›m (Updated)",
    "startTime": "06:30:00",
    "endTime": "08:30:00",
    "isActive": true,
    "createdAt": "2026-01-14T00:53:15.123456Z",
    "updatedAt": "2026-01-14T01:30:00.123456Z",
    "createdBy": "admin",
    "updatedBy": "admin"
  }
}
```

**Error Response** (404 Not Found):
```json
{
  "statusCode": 404,
  "message": "Slot not found with id: 999",
  "error": "Id Invalid Exception"
}
```

**Error Response** (400 Bad Request):
```json
{
  "statusCode": 400,
  "message": "Start time must be before end time",
  "error": "Bad Request"
}
```

---

### 7. Activate Slot
**PUT** `/api/v1/slots/{id}/activate`

**Description**: KÃ­ch hoáº¡t láº¡i slot (set isActive = true)

**Path Parameters**:
- `id`: ID cá»§a slot cáº§n kÃ­ch hoáº¡t

**Success Response** (200 OK):
```json
{
  "statusCode": 200,
  "message": "Activate slot",
  "data": {
    "id": 1,
    "slotName": "Slot 1 - SÃ¡ng sá»›m",
    "startTime": "06:00:00",
    "endTime": "08:00:00",
    "isActive": true,
    "createdAt": "2026-01-14T00:53:15.123456Z",
    "updatedAt": "2026-01-14T02:00:00.123456Z",
    "createdBy": "admin",
    "updatedBy": "admin"
  }
}
```

**Error Response** (404 Not Found):
```json
{
  "statusCode": 404,
  "message": "Slot not found with id: 999",
  "error": "Id Invalid Exception"
}
```

---

### 8. Deactivate Slot (Soft Delete)
**DELETE** `/api/v1/slots/{id}`

**Description**: VÃ´ hiá»‡u hÃ³a slot (set isActive = false) - soft delete, khÃ´ng xÃ³a khá»i database

**Path Parameters**:
- `id`: ID cá»§a slot cáº§n vÃ´ hiá»‡u hÃ³a

**Success Response** (204 No Content):
```
(No response body)
```

**Error Response** (404 Not Found):
```json
{
  "statusCode": 404,
  "message": "Slot not found with id: 999",
  "error": "Id Invalid Exception"
}
```

---

## ğŸ“ Notes

### Time Validation Logic
- Há»‡ thá»‘ng tá»± Ä‘á»™ng validate `startTime` pháº£i nhá» hÆ¡n `endTime`
- Náº¿u vi pháº¡m sáº½ throw `IllegalArgumentException` vá»›i message: "Start time must be before end time"

### Soft Delete
- DELETE endpoint khÃ´ng xÃ³a slot khá»i database
- Chá»‰ set `isActive = false`
- CÃ³ thá»ƒ kÃ­ch hoáº¡t láº¡i báº±ng endpoint `/activate`

### Default Values
- Khi táº¡o má»›i slot, `isActive` máº·c Ä‘á»‹nh = `true`
- `createdAt` vÃ  `createdBy` tá»± Ä‘á»™ng Ä‘Æ°á»£c gÃ¡n khi táº¡o má»›i
- `updatedAt` vÃ  `updatedBy` tá»± Ä‘á»™ng Ä‘Æ°á»£c cáº­p nháº­t khi cÃ³ thay Ä‘á»•i

### Pagination
- Endpoint `/fetch` há»— trá»£ Spring Data JPA Specification
- CÃ³ thá»ƒ filter theo báº¥t ká»³ field nÃ o: slotName, startTime, endTime, isActive
- Há»— trá»£ cÃ¡c operator: `==`, `!=`, `>`, `<`, `>=`, `<=`, `~` (like)

---

## ğŸ” Use Cases

### Use Case 1: Táº¡o lá»‹ch khung giá» cho phÃ²ng gym
**Má»¥c Ä‘Ã­ch**: Táº¡o cÃ¡c slot thá»i gian cá»‘ Ä‘á»‹nh trong ngÃ y

**Steps**:
1. POST `/api/v1/slots` vá»›i slot "SÃ¡ng sá»›m" (06:00-08:00)
2. POST `/api/v1/slots` vá»›i slot "Buá»•i sÃ¡ng" (08:00-10:00)
3. POST `/api/v1/slots` vá»›i slot "Buá»•i trÆ°a" (10:00-12:00)
4. ...tiáº¿p tá»¥c cho cÃ¡c khung giá» khÃ¡c

### Use Case 2: Xem táº¥t cáº£ slot Ä‘ang active Ä‘á»ƒ booking
**Má»¥c Ä‘Ã­ch**: Hiá»ƒn thá»‹ danh sÃ¡ch slot kháº£ dá»¥ng cho member Ä‘áº·t lá»‹ch

**Steps**:
1. GET `/api/v1/slots/active`
2. Hiá»ƒn thá»‹ danh sÃ¡ch cho user chá»n

### Use Case 3: TÃ¬m kiáº¿m slot trong khoáº£ng thá»i gian
**Má»¥c Ä‘Ã­ch**: Lá»c cÃ¡c slot trong giá» cao Ä‘iá»ƒm (08:00-18:00)

**Steps**:
1. GET `/api/v1/slots/fetch?filter=startTime>='08:00:00' and endTime<='18:00:00'`
2. Xem káº¿t quáº£ cÃ¡c slot trong khoáº£ng thá»i gian Ä‘Ã³

### Use Case 4: VÃ´ hiá»‡u hÃ³a slot khÃ´ng cÃ²n sá»­ dá»¥ng
**Má»¥c Ä‘Ã­ch**: Táº¡m ngÆ°ng slot mÃ  khÃ´ng xÃ³a dá»¯ liá»‡u lá»‹ch sá»­

**Steps**:
1. DELETE `/api/v1/slots/5` (vÃ´ hiá»‡u hÃ³a slot ID 5)
2. Slot váº«n cÃ²n trong DB nhÆ°ng isActive = false
3. Náº¿u cáº§n dÃ¹ng láº¡i: PUT `/api/v1/slots/5/activate`

---

## âš ï¸ Common Errors

### 1. Thá»i gian khÃ´ng há»£p lá»‡
**Error**: `Start time must be before end time`
**Cause**: startTime >= endTime
**Solution**: Äáº£m báº£o startTime < endTime

### 2. Slot khÃ´ng tá»“n táº¡i
**Error**: `Slot not found with id: {id}`
**Cause**: ID khÃ´ng tá»“n táº¡i trong database
**Solution**: Kiá»ƒm tra láº¡i ID hoáº·c dÃ¹ng GET `/api/v1/slots` Ä‘á»ƒ xem danh sÃ¡ch

### 3. Validation failed
**Error**: `Slot name is required` hoáº·c `Start time is required`
**Cause**: Thiáº¿u field báº¯t buá»™c trong request body
**Solution**: Cung cáº¥p Ä‘áº§y Ä‘á»§ cÃ¡c field required

---

## ğŸ” Security

- Táº¥t cáº£ endpoints yÃªu cáº§u authentication (401 náº¿u chÆ°a Ä‘Äƒng nháº­p)
- Audit fields (createdBy, updatedBy) tá»± Ä‘á»™ng láº¥y tá»« SecurityContext
- Náº¿u khÃ´ng cÃ³ user trong context, sáº½ dÃ¹ng "system" lÃ m default

---

## ğŸ“Š Response Format

Táº¥t cáº£ response Ä‘á»u theo format chuáº©n:
```json
{
  "statusCode": 200,
  "message": "API message tá»« @ApiMessage annotation",
  "data": {...}  // hoáº·c [...] vá»›i array
}
```

Error response format:
```json
{
  "statusCode": 4xx/5xx,
  "message": "Error message",
  "error": "Error type"
}
```

---

**End of SlotController Documentation**
